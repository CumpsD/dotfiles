---
- name: Update pacman (pacman -Syu)
  pacman:
    update_cache: yes
    upgrade: yes

- name: Add AUR builder user
  user:
    name: aur_builder
    group: wheel

- name: Allow AUR builder to run pacman
  lineinfile:
    path: /etc/sudoers.d/11-install-aur_builder
    line: 'aur_builder ALL=(ALL) NOPASSWD: /usr/bin/pacman'
    create: yes
    validate: 'visudo -cf %s'

- name: Install yay
  become: yes
  become_user: aur_builder
  aur:
    use: makepkg
    name: [
        'yay']

- name: Install basic command-line utilities
  pacman:
    name: [
        'curl',
        'gnupg',
        'htop',
        'wget',
        'unzip',
        'gzip',
        'bzip2',
        'dos2unix',
        'xloadimage',
        'screenfetch',
        'lsof',
        'openssh',
        'pcsclite',
        'udisks2']
    state: latest

- name: Install basic command-line utilities (AUR)
  become: yes
  become_user: aur_builder
  aur:
    use: yay
    name: [
        'gotop']

- name: Install essential build tools
  pacman:
    name: [
        'intltool',
        'libtool',
        'ruby',
        'rubygems',
        'unixodbc',
        'python',
        'python-pip',
        'jdk-openjdk',
        'libunwind']
    state: latest

- name: Install essential build tools (AUR)
  become: yes
  become_user: aur_builder
  aur:
    use: yay
    name: [
        'json-c',
        'libsndfile-git']

- name: Install NFS Tooling
  pacman:
    name: [
        'nfs-utils',
        'autofs']
    state: latest

- name: Install rEFInd
  pacman:
    name: [
        'refind-efi']
    state: latest

- name: Install Git and Hub
  pacman:
    name: [
        'git',
        'hub',
        'git-crypt']
    state: latest

- name: Install Node and NPM
  pacman:
    name: [
        'nodejs',
        'npm']
    state: latest

- name: Install Solarized Console and Tulizu
  become: yes
  become_user: aur_builder
  aur:
    use: yay
    name: [
        'console-solarized-git',
        'tulizu']

- name: Install Azure cli package
  become: yes
  become_user: aur_builder
  aur:
    use: yay
    name: [
        'python-azure-cli']

- name: Install mssql-tools package
  become: yes
  become_user: aur_builder
  aur:
    use: yay
    name: [
        'mssql-tools']
  environment:
    ACCEPT_EULA: "y"

- name: Install Ruby tools
  become: yes
  become_user: "{{ lookup('env','LOGNAME') }}"
  gem:
    name: "{{ item }}"
    state: latest
    user_install: yes
  with_items:
    - fpm
    - deb-s3
